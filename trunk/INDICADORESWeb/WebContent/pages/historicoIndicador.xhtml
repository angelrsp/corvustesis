<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head></h:head>
<body>

	<ui:composition template="/template/privado.xhtml">
		<ui:define name="contenido">
<h:form id="contenido" enctype="multipart/form-data">

			<fieldset>
				<p:growl id="growl" showDetail="false" />
				<p:panel id="pnlDatos" styleClass="tabla"
					header="Historico Indicador">
					
					<table>
						<tr>
							<td><h:outputLabel value="#{i18n['label.modelo']}:&#160;" /> </td>
							<td><p:selectOneMenu required="true" requiredMessage="#{i18n['label.modelo']}:&#160;#{i18n['label.requerido']}" value="#{historicoIndicadorController.modelo}">
									<f:selectItem itemLabel="#{i18n['combo.seleccionar']}" itemValue=""/>
									<f:selectItems value="#{historicoIndicadorController.modeloList}"></f:selectItems>
									<p:ajax event="change" process="@this" update="tree" listener="#{historicoIndicadorController.obtenerArbol}" immediate="true"></p:ajax>
									<p:ajax event="change" process="@this" update="tree" listener="#{historicoIndicadorController.obtenerArbol}" immediate="true"></p:ajax>										
							</p:selectOneMenu></td>
						</tr>
						<tr>
							<td><h:outputLabel value="#{i18n['label.ies']}:&#160;" /> </td>
							<td><p:selectOneMenu required="true" requiredMessage="#{i18n['label.ies']}:&#160;#{i18n['label.requerido']}" value="#{historicoIndicadorController.ies}">
									<f:selectItem itemLabel="#{i18n['combo.seleccionar']}" itemValue=""/>
									<f:selectItems value="#{historicoIndicadorController.iesList}"></f:selectItems>
									<p:ajax event="change" process="@this" update="tree" listener="#{historicoIndicadorController.obtenerArbol}" immediate="true"></p:ajax>
									<p:ajax event="change" process="@this" update="tree" listener="#{historicoIndicadorController.obtenerArbol}" immediate="true"></p:ajax>																			
							</p:selectOneMenu></td>
						</tr>
					</table>
					
				<p:tree value="#{historicoIndicadorController.rootNode}" var="node" id="tree" selectionMode="single" selection="#{historicoIndicadorController.selectedNode}">
					<p:ajax event="select" listener="#{historicoIndicadorController.onNodeSelect}" update=":contenido:growl,:contenido:pnlValor"/>  
			        <p:treeNode id="treeNode">  
			            <h:outputText value="#{node.indNombreCorto}"/>  
			        </p:treeNode>  
			    </p:tree>  
					
				</p:panel>
				
				
				<p:dialog id="dlgValor" widgetVar="dlgValor" modal="true" header="Valores" closeOnEscape="true">
				
				<p:panel id="pnlValor" styleClass="tabla"
					header="Valor">
				
					<table>
						<tr>
							<td><h:outputLabel value="#{i18n['label.valor']}:&#160;" /> </td>
							<td><p:inputText required="true"
										requiredMessage="#{i18n['label.valor']}&#160;#{i18n['label.requerido']}"
										value="#{historicoIndicadorController.historicoIndicadorDTO.hinValor}" onkeypress="return isDecimalKey(event)"/></td>
						</tr>
						<tr>
							<td><h:outputLabel value="#{i18n['label.observacion']}:&#160;" /> </td>
							<td><p:inputText required="true"
										requiredMessage="#{i18n['label.observacion']}&#160;#{i18n['label.requerido']}"
										value="#{historicoIndicadorController.historicoIndicadorDTO.hinObservacion}"/></td>
						</tr>		

					<tr>
						<td colspan="2" align="center">
							<p:commandButton actionListener="#{historicoIndicadorController.agregarValor}" value="#{i18n['boton.agregar']}" process="pnlValor" update="pnlValor,growl"/> </td>
					</tr>
						
					</table>
					
					
					<p:dataTable id="tblValor" value="#{historicoIndicadorController.historicoIndicadorList}" var="his">
					
						<p:column headerText="#{i18n['label.valor']}">
							<h:outputText value="#{his.hinValor}" />
						</p:column>

						<p:column headerText="#{i18n['label.fecha']}">
							<h:outputText value="#{his.hinFecha}" />
						</p:column>
					
						<p:column headerText="#{i18n['label.observacion']}">
							<h:outputText value="#{his.hinObservacion}" />
						</p:column>
					
						<p:column style="width:8%" headerText="#{i18n['label.evidencia']}">  
			                <p:commandButton actionListener="#{historicoIndicadorController.buscarEvidencias(his)}" oncomplete="PF('dlgEvidencia').show()" icon="ui-icon-document" 
			                	update=":contenido:pnlEvidencia,:contenido:growl" process="tblValor" title="#{i18n['label.evidencia']}">    
			    	        </p:commandButton>  
				        </p:column>  					
										
					</p:dataTable>
										
					
				</p:panel>

				</p:dialog>

				<p:dialog id="dlgEvidencia" widgetVar="dlgEvidencia" modal="true" header="Evidencias" closeOnEscape="true">
				<p:panel id="pnlEvidencia" styleClass="tabla"
					header="Evidencia">

					<table>
						<tr>
							<td><h:outputLabel value="#{i18n['label.nombre']}:&#160;" /> </td>
							<td><p:inputText required="true"
										requiredMessage="#{i18n['label.nombre']}&#160;#{i18n['label.requerido']}"
										value="#{historicoIndicadorController.evidenciaDTO.eviNombre}"/></td>
						</tr>
						<tr>
							<td><h:outputLabel value="#{i18n['label.observacion']}:&#160;" /> </td>
							<td><p:inputText required="true"
										requiredMessage="#{i18n['label.observacion']}&#160;#{i18n['label.requerido']}"
										value="#{historicoIndicadorController.evidenciaDTO.eviObservacion}"/></td>
						</tr>
						
						<tr>
							<td><h:outputLabel value="#{i18n['label.archivo']}:&#160;" /></td>
							<td>
	        	     			<p:fileUpload fileUploadListener="#{historicoIndicadorController.handleFileUpload}" mode="advanced" dragDropSupport="false"  
                  					update=":contenido:growl" sizeLimit="1000000" fileLimit="1" allowTypes="/(\.|\/)(pdf)$/" label="Seleccionar..." uploadLabel="Subir" cancelLabel="Cancelar" />			
							</td>
						</tr>
						
						<tr>
							<td colspan="2" align="center">
								<p:commandButton actionListener="#{historicoIndicadorController.agregarEvidencia}" value="#{i18n['boton.agregar']}" process="pnlEvidencia" update="pnlEvidencia,growl"/> </td>
						</tr>
										
					</table>

					<p:dataTable id="tblEvidencia" value="#{historicoIndicadorController.evidenciaList}" var="evi">
					
						<p:column headerText="#{i18n['label.nombre']}">
							<h:outputText value="#{evi.eviNombre}" />
						</p:column>
					
						<p:column headerText="#{i18n['label.observacion']}">
							<h:outputText value="#{evi.eviObservacion}" />
						</p:column>

						<p:column headerText="#{i18n['label.descargar']}">
			                <p:commandButton actionListener="#{historicoIndicadorController.descargarEvidencia(evi)}" icon="ui-icon-arrow-1-s" ajax="false" immediate="true" 
			                	title="#{i18n['label.descargar']}">    
			    	        </p:commandButton>  
						</p:column>
															
					</p:dataTable>


				</p:panel>
								
				</p:dialog>
				
	
			</fieldset>
</h:form>				
		</ui:define>
	</ui:composition>
</body>					

</html>